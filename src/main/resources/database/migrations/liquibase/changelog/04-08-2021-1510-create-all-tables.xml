<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="cards"/>
            </not>
        </preConditions>

        <createTable tableName="cards">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="card_number" type="VARCHAR(255)"/>
            <column name="card_holder" type="VARCHAR(255)"/>
            <column name="date_expiration" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(255)"/>
            <column defaultValueBoolean="false" name="main" type="BOOLEAN"/>
            <column name="payment_id" type="VARCHAR(36)"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="coordinates"/>
            </not>
        </preConditions>

        <createTable tableName="coordinates">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="latitude" type="VARCHAR(255)"/>
            <column name="longitude" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="locations"/>
            </not>
        </preConditions>

        <createTable tableName="locations">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="country" type="VARCHAR(255)"/>
            <column name="city" type="VARCHAR(255)"/>
            <column name="street" type="VARCHAR(255)"/>
            <column name="building" type="VARCHAR(255)"/>
            <column name="coordinates_id" type="VARCHAR(36)"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-5">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="payments"/>
            </not>
        </preConditions>

        <createTable tableName="payments">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="country" type="VARCHAR(255)"/>
            <column name="address" type="VARCHAR(255)"/>
            <column name="post_code" type="VARCHAR(255)"/>
            <column name="phone_number" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-6">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ride_locations"/>
            </not>
        </preConditions>

        <createTable tableName="ride_locations">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="ride_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="position_time" type="timestamp"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-7">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="rides"/>
            </not>
        </preConditions>

        <createTable tableName="rides">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="start_time" type="timestamp"/>
            <column name="end_time" type="timestamp"/>
            <column name="ride_status" type="VARCHAR(255)"/>
            <column name="tariff_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="scooter_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_status" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-8">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="roles"/>
            </not>
        </preConditions>

        <createTable tableName="roles">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column defaultValueBoolean="false" name="active" type="BOOLEAN"/>
            <column defaultValueBoolean="false" name="admin" type="BOOLEAN"/>
            <column defaultValueBoolean="false" name="modifiable" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-9">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="scooter_statistic"/>
            </not>
        </preConditions>

        <createTable tableName="scooter_statistic">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="count" type="INT"/>
            <column name="date" type="date"/>
            <column name="time" type="time"/>
            <column name="location_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-10">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="scooters"/>
            </not>
        </preConditions>

        <createTable tableName="scooters">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="manufacturer" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="model" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="photo_url" type="VARCHAR(500)"/>
            <column name="battery_charge" type="INT"/>
            <column name="last_service" type="timestamp"/>
            <column name="software_version" type="VARCHAR(255)"/>
            <column defaultValueBoolean="false" name="active" type="BOOLEAN"/>
            <column defaultValueBoolean="false" name="charging" type="BOOLEAN"/>
            <column name="location_id" type="VARCHAR(36)"/>
            <column name="status" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-11">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="tariffs"/>
            </not>
        </preConditions>

        <createTable tableName="tariffs">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="costs" type="INT"/>
            <column defaultValueBoolean="false" name="active" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-12">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="tokens"/>
            </not>
        </preConditions>

        <createTable tableName="tokens">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="user_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="creation_date" type="timestamp"/>
            <column name="token" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column defaultValueBoolean="false" name="active" type="BOOLEAN"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-13">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_locations"/>
            </not>
        </preConditions>

        <createTable tableName="user_locations">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="user_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="position_time" type="timestamp"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-14">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>

        <createTable tableName="users">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="INT"/>
            <column name="firstname" type="VARCHAR(255)"/>
            <column name="lastname" type="VARCHAR(255)"/>
            <column name="phone_number" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="photo_url" type="VARCHAR(500)"/>
            <column defaultValueBoolean="false" name="active" type="BOOLEAN"/>
            <column name="role_id" type="VARCHAR(36)"/>
        </createTable>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-15">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_cards_payment_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_cards_payment_id" tableName="cards">
            <column name="payment_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-16">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_locations_coordinates_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_locations_coordinates_id" tableName="locations">
            <column name="coordinates_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-17">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_payments_user_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_payments_user_id" tableName="payments">
            <column name="user_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-18">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_ride_locations_location_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_ride_locations_location_id" tableName="ride_locations">
            <column name="location_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-19">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_ride_locations_ride_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_ride_locations_ride_id" tableName="ride_locations">
            <column name="ride_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-20">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_rides_scooter_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_rides_scooter_id" tableName="rides">
            <column name="scooter_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-21">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_rides_tariff_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_rides_tariff_id" tableName="rides">
            <column name="tariff_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-22">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_rides_user_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_rides_user_id" tableName="rides">
            <column name="user_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-23">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_scooter_statistic_location_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_scooter_statistic_location_id" tableName="scooter_statistic">
            <column name="location_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-24">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_scooters_location_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_scooters_location_id" tableName="scooters">
            <column name="location_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-25">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_tokens_user_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_tokens_user_id" tableName="tokens">
            <column name="user_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-26">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_user_locations_location_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_user_locations_location_id" tableName="user_locations">
            <column name="location_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-27">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_user_locations_user_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_user_locations_user_id" tableName="user_locations">
            <column name="user_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-28">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="fk_users_role_id"/>
            </not>
        </preConditions>

        <createIndex indexName="fk_users_role_id" tableName="users">
            <column name="role_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-30">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_cards_payment_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="payment_id" baseTableName="cards" constraintName="fk_cards_payment_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE"
                                 referencedColumnNames="id" referencedTableName="payments" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-31">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_locations_coordinates_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="coordinates_id" baseTableName="locations"
                                 constraintName="fk_locations_coordinates_id" deferrable="false"
                                 initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE"
                                 referencedColumnNames="id" referencedTableName="coordinates" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-32">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_payments_user_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="payments" constraintName="fk_payments_user_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE"
                                 referencedColumnNames="id" referencedTableName="users" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-33">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_ride_locations_location_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="ride_locations"
                                 constraintName="fk_ride_locations_location_id" deferrable="false"
                                 initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="locations" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-34">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_ride_locations_ride_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="ride_id" baseTableName="ride_locations"
                                 constraintName="fk_ride_locations_ride_id" deferrable="false" initiallyDeferred="false"
                                 onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id"
                                 referencedTableName="rides" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-35">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_rides_scooter_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="scooter_id" baseTableName="rides" constraintName="fk_rides_scooter_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="scooters" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-36">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_rides_tariff_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="tariff_id" baseTableName="rides" constraintName="fk_rides_tariff_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="tariffs" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-37">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_rides_user_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="rides" constraintName="fk_rides_user_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="users" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-38">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_scooter_statistic_location_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="scooter_statistic"
                                 constraintName="fk_scooter_statistic_location_id" deferrable="false"
                                 initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="locations" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-39">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_scooters_location_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="scooters"
                                 constraintName="fk_scooters_location_id" deferrable="false" initiallyDeferred="false"
                                 onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id"
                                 referencedTableName="locations" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-40">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_tokens_user_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="tokens" constraintName="fk_tokens_user_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="users" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-41">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_user_locations_location_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="user_locations"
                                 constraintName="fk_user_locations_location_id" deferrable="false"
                                 initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="locations" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-42">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_user_locations_user_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="user_locations"
                                 constraintName="fk_user_locations_user_id" deferrable="false" initiallyDeferred="false"
                                 onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id"
                                 referencedTableName="users" validate="true"/>
    </changeSet>

    <changeSet author="Kiryl Shalpuk" id="04-08-2021-1510-43">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_users_role_id"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint baseColumnNames="role_id" baseTableName="users" constraintName="fk_users_role_id"
                                 deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT"
                                 referencedColumnNames="id" referencedTableName="roles" validate="true"/>
    </changeSet>
</databaseChangeLog>
